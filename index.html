<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Starbucks">

    <title>Starbucks App</title>
    <style>
        :root {
            --bg-color: #3b6e3b;
            --accent-color: #fff;
        }

        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #1a1a1a;
            font-family: -apple-system, "PingFang SC", "Heiti SC", "Microsoft YaHei", sans-serif;
            overflow: hidden;
            touch-action: none; 
        }

        .phone {
            width: 100%;
            height: 100vh;
            max-width: 450px;
            background: linear-gradient(to bottom, #111, var(--bg-color), #000);
            position: relative;
            overflow: hidden;
            color: white;
            transition: background 0.6s ease;
            display: flex;
            flex-direction: column;
        }

        /* --- ENTRANCE ANIMATIONS (CSS) --- */
        .spring-up {
            animation: springUp 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            opacity: 0;
            transform: translateY(60px) scale(0.9);
        }
        @keyframes springUp { 
            to { opacity: 1; transform: translateY(0) scale(1); } 
        }

        .fade-slide-in {
            animation: fadeSlideIn 0.6s cubic-bezier(0.25, 1, 0.5, 1) forwards;
            opacity: 0;
            transform: translateY(30px);
        }
        @keyframes fadeSlideIn { 
            to { opacity: 1; transform: translateY(0); } 
        }

        .slide-down-header {
            animation: slideDownHeader 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            opacity: 0;
            transform: translateY(-40px);
        }
        @keyframes slideDownHeader {
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- HEADER (FIXED) --- */
        .header {
            padding: 50px 20px 10px;
            display: flex;
            justify-content: space-between;
            flex-shrink: 0;
            z-index: 300; 
            position: relative;
            opacity: 0; /* Hidden initially for animation */
        }
        .icon-btn {
            width: 40px; height: 40px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            display: flex;
            align-items: center; justify-content: center;
            cursor: pointer;
            position: relative;
            font-size: 20px; 
            backdrop-filter: blur(10px);
        }
        .icon-btn:active { background: rgba(255,255,255,0.2); }
        
        .badge {
            position: absolute; top: -5px; right: -5px;
            background: red; color: white;
            font-size: 10px; font-weight: bold;
            width: 18px; height: 18px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            opacity: 0; transition: opacity 0.3s;
        }
        .badge.show { opacity: 1; }

        /* --- SLIDING CONTENT WRAPPER --- */
        /* This moves up when cart appears */
        .slide-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            will-change: transform;
            position: relative;
            z-index: 100;
        }

        .phone.cart-active .slide-content {
            transform: translateY(-80px); 
        }

        .drink-container {
            height: 320px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 10px;
            z-index: 10; 
            flex-shrink: 0;
            perspective: 1000px; 
        }

        .cup {
            position: absolute;
            height: 230px;
            transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.4s ease;
            filter: drop-shadow(0 20px 30px rgba(0,0,0,0.5)); 
            transform-origin: bottom center;
            will-change: transform;
        }
        
        /* Initial State for Entrance */
        .cup.enter-state {
            transform: translateY(100px) scale(0.5);
            opacity: 0;
        }
        
        .flying-cup {
            position: fixed;
            height: 230px;
            z-index: 999;
            pointer-events: none;
            transition: all 0.6s cubic-bezier(0.5, 0, 0.5, 1);
        }

        .counter-area {
            display: flex; justify-content: center; align-items: center;
            gap: 30px; margin-bottom: 20px; z-index: 100;
            flex-shrink: 0;
            opacity: 0; 
        }
        .qty-btn {
            width: 35px; height: 35px; border-radius: 50%;
            background: rgba(255,255,255,0.2); border: none;
            color: white; font-size: 20px; cursor: pointer;
        }
        
        /* NUMBER ANIMATION CONTAINER */
        .qty-display {
            font-size: 40px; font-weight: bold; width: 60px; height: 50px;
            text-align: center; position: relative; overflow: hidden;
            display: flex; justify-content: center; align-items: center;
        }
        /* The sliding numbers */
        .qty-num {
            position: absolute;
            width: 100%; text-align: center;
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.4s ease;
        }

        .info-area { 
            text-align: left; padding: 0 25px; z-index: 100; flex-shrink: 0; 
            opacity: 0; 
        }
        
        .title-row {
            display: flex; justify-content: flex-start; align-items: center;
            font-size: 24px; font-weight: bold; margin-bottom: 8px; height: 40px; 
        }

        .anim-box { position: relative; height: 40px; overflow: hidden; display: flex; align-items: center; padding-right: 2px; }
        .anim-text { display: block; white-space: nowrap; line-height: 40px; }
        .static-suffix { line-height: 40px; }
        .slide-in { animation: slideInUp 0.7s cubic-bezier(0.5, -0.5, 0.1, 1.6) forwards; }
        .slide-out { position: absolute; top: 0; left: 0; width: 100%; animation: slideOutUp 0.4s ease-in forwards; }
        @keyframes slideInUp { 0% { transform: translateY(120%); opacity: 0; } 100% { transform: translateY(0); opacity: 1; } }
        @keyframes slideOutUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-120%); opacity: 0; } }

        .subtitle { font-size: 11px; opacity: 0.7; line-height: 1.4; margin-bottom: 10px; }

        .options { 
            padding: 0 25px; 
            display: flex; flex-direction: column; gap: 15px; z-index: 100;
            flex: 1; 
            overflow-y: auto; 
            opacity: 0; 
        }

        .option-row { display: flex; align-items: center; justify-content: space-between; gap: 10px; flex-shrink: 0; }
        .option-label { font-size: 14px; font-weight: bold; opacity: 0.9; width: 40px; white-space: nowrap; }

        .segment-control {
            flex: 1; background: rgba(0,0,0,0.15); border-radius: 40px;
            padding: 3px; display: flex; position: relative; height: 42px; 
        }
        
        .segment-opt {
            flex: 1; text-align: center; font-size: 12px;
            font-weight: bold; z-index: 2; cursor: pointer; opacity: 0.5; transition: opacity 0.3s;
            color: white; display: flex; flex-direction: row; align-items: center; justify-content: center; gap: 3px; height: 100%;
        }
        .segment-opt.active { opacity: 1; }
        .vol-label { font-size: 10px; opacity: 0.8; padding-top: 1px; }
        
        .pill {
            position: absolute; background: rgba(255, 255, 255, 0.2); 
            height: calc(100% - 6px); width: calc(33.33% - 2px); border-radius: 35px;
            top: 3px; left: 3px; transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); z-index: 1; 
        }

        .add-btn {
            margin: 10px 25px 40px; 
            background: white;
            border-radius: 40px; padding: 18px 25px;
            display: flex; justify-content: center; gap: 10px;
            align-items: center; cursor: pointer; border: none;
            z-index: 100;
            flex-shrink: 0;
            opacity: 0; 
        }
        .add-btn:active { transform: scale(0.98); }
        .btn-text, .price { font-weight: bold; font-size: 16px; color: var(--bg-color); }

        /* CART TRAY */
        .cart-bar {
            position: absolute; bottom: 0; left: 0; width: 100%;
            height: 80px;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(20px);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 25px; 
            padding-bottom: env(safe-area-inset-bottom);
            box-sizing: border-box;
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 200;
            border-top-left-radius: 20px; border-top-right-radius: 20px;
        }
        .cart-bar.show { transform: translateY(0); }
        
        .checkout-btn {
            background: #fff; color: black;
            padding: 10px 20px; border-radius: 20px; font-weight: bold; font-size: 14px;
        }

    </style>
</head>
<body>

    <div class="phone" id="phoneApp">
        <div class="header" id="headerArea">
            <div class="icon-btn" onclick="resetAll()">‚Üª</div>
            <div class="icon-btn">
                üõí
                <div class="badge" id="cartBadge">0</div>
            </div>
        </div>

        <div class="slide-content">
            <div class="drink-container" id="cupContainer"></div>

            <div class="counter-area" id="counterArea">
                <button class="qty-btn" onclick="updateQty(-1)">‚àí</button>
                <div class="qty-display" id="qtyDisplay">
                    <span class="qty-num">1</span>
                </div>
                <button class="qty-btn" onclick="updateQty(1)">+</button>
            </div>

            <div class="info-area" id="infoArea">
                <div class="title-row">
                    <div class="anim-box" id="animContainer">
                        <span class="anim-text">ÊäπËå∂</span>
                    </div>
                    <span class="static-suffix">ÊòüÂÜ∞‰πê</span>
                </div>
                <div class="subtitle">ÈÄöËøáMobile Order & Pay ÊèêÂâçËÆ¢Ë¥≠È£üÂìÅÂèäÈ•ÆÂìÅÔºåÂπ∂‰∫éÈôÑËøëÂàÜÂ∫óÈ¢ÜÂèñÊÇ®ÁöÑËÆ¢Âçï„ÄÇ</div>
            </div>

            <div class="options" id="optionsArea">
                <div class="option-row">
                    <div class="option-label">ÊùØÂûã</div>
                    <div class="segment-control">
                        <div class="pill" id="sizePill"></div>
                        <div class="segment-opt active" onclick="setSize(0)">
                            <span>‰∏≠ÊùØ</span><span class="vol-label">355ml</span>
                        </div>
                        <div class="segment-opt" onclick="setSize(1)">
                            <span>Â§ßÊùØ</span><span class="vol-label">473ml</span>
                        </div>
                        <div class="segment-opt" onclick="setSize(2)">
                            <span>Ë∂ÖÂ§ßÊùØ</span><span class="vol-label">592ml</span>
                        </div>
                    </div>
                </div>

                <div class="option-row">
                    <div class="option-label">Âè£Âë≥</div> 
                    <div class="segment-control">
                        <div class="pill" id="flavorPill"></div>
                        <div class="segment-opt active" onclick="setFlavor(0)">ÊäπËå∂</div>
                        <div class="segment-opt" onclick="setFlavor(1)">Â∑ßÂÖãÂäõ</div>
                        <div class="segment-opt" onclick="setFlavor(2)">ËäíÊûú</div>
                    </div>
                </div>
            </div>

            <button class="add-btn" id="addBtn" onclick="addToCart()">
                <span class="btn-text" id="btnText">Ê∑ªÂä† +</span>
                <span class="price" id="priceText">¬•30</span>
            </button>
        </div>

        <div class="cart-bar" id="cartBar">
            <div style="color:white; font-size:14px;">
                <div style="font-weight:bold; margin-bottom:4px;">Ë¥≠Áâ©ËΩ¶</div>
                <div id="cartTotal" style="opacity:0.7">0 items ‚Ä¢ ¬•0</div>
            </div>
            <div class="checkout-btn">ÂéªÁªìÁÆó</div>
        </div>
    </div>

    <script>
        // --- SOUND ---
        const saleSound = new Audio('shopify_sale_sound.mp3');
        
        // --- DATA ---
        const flavors = [
            { name: "ÊäπËå∂", color: "#3b6e3b", btnColor: "#3b6e3b", img: "matcha.png", xFix: 5, yFix: 0 },
            { name: "Â∑ßÂÖãÂäõ", color: "#5d4037", btnColor: "#5d4037", img: "chocolate.png", xFix: 0, yFix: 0 },
            { name: "ËäíÊûú", color: "#e67e22", btnColor: "#e67e22", img: "mango.png", xFix: 0, yFix: 0 }
        ];

        const sizes = [
            { priceMod: 0, scaleFactor: 1.0 },
            { priceMod: 3, scaleFactor: 1.15 },
            { priceMod: 6, scaleFactor: 1.3 } 
        ];

        let state = { qty: 1, flavorIdx: 0, sizeIdx: 0 };
        let lastFlavorName = "ÊäπËå∂";
        let cart = [];
        let isAnimComplete = false;

        const cupContainer = document.getElementById('cupContainer');
        const animContainer = document.getElementById('animContainer');
        const phoneApp = document.getElementById('phoneApp');
        const cups = [];

        // --- INIT ---
        function initCups() {
            for(let i=0; i<5; i++) {
                const img = document.createElement('img');
                img.classList.add('cup');
                img.classList.add('enter-state'); // Start hidden for entrance
                img.style.zIndex = i;
                cupContainer.appendChild(img);
                cups.push(img);
            }
        }
        initCups();

        // --- ENTRANCE SEQUENCE ---
        window.onload = function() {
            // 1. Header Drop
            setTimeout(() => document.getElementById('headerArea').classList.add('slide-down-header'), 100);

            // 2. Main Cup Pop (Hero)
            setTimeout(() => {
                isAnimComplete = true; // Unlock render loop
                cups[0].classList.remove('enter-state');
                render(); 
            }, 300);

            // 3. Staggered UI
            setTimeout(() => document.getElementById('counterArea').classList.add('fade-slide-in'), 400);
            setTimeout(() => document.getElementById('infoArea').classList.add('fade-slide-in'), 500);
            setTimeout(() => document.getElementById('optionsArea').classList.add('fade-slide-in'), 650);
            setTimeout(() => document.getElementById('addBtn').classList.add('fade-slide-in'), 800);
        };

        // --- RESET ---
        function resetAll() {
            state = { qty: 1, flavorIdx: 0, sizeIdx: 0 };
            cart = [];
            
            // Hard reset number text
            const container = document.getElementById('qtyDisplay');
            container.innerHTML = '<span class="qty-num">1</span>';

            updateCartUI();
            render();
            document.querySelector('.anim-text').innerText = flavors[0].name;
            lastFlavorName = flavors[0].name;
        }

        // --- RENDER LOGIC ---
        function updateFlavorAnim(newName) {
            if (newName === lastFlavorName) return;
            const oldEl = animContainer.querySelector('.anim-text:not(.slide-out)');
            const newEl = document.createElement('span');
            newEl.innerText = newName;
            newEl.classList.add('anim-text');
            newEl.classList.add('slide-in');
            if (oldEl) {
                oldEl.classList.remove('slide-in');
                oldEl.classList.add('slide-out');
                setTimeout(() => { if(oldEl.parentNode) oldEl.parentNode.removeChild(oldEl); }, 400);
            }
            animContainer.appendChild(newEl);
            lastFlavorName = newName;
        }

        function render() {
            if (!isAnimComplete) return;

            const flav = flavors[state.flavorIdx];
            const size = sizes[state.sizeIdx];

            document.documentElement.style.setProperty('--bg-color', flav.color);
            updateFlavorAnim(flav.name);

            document.getElementById('priceText').innerText = "¬•" + ((30 + size.priceMod) * state.qty);
            document.getElementById('btnText').style.color = flav.btnColor;
            document.getElementById('priceText').style.color = flav.btnColor;

            cups.forEach((cup, i) => {
                cup.src = flav.img;
                let x = 0, y = 50, s = 0, o = 0, z = 0;

                const visualCount = Math.min(state.qty, 5);

                if (i < visualCount) {
                     cup.classList.remove('enter-state');

                     // WEDGE Logic
                     const centerIdx = (visualCount - 1) / 2;
                     const dist = Math.abs(i - centerIdx); 
                     const dir = (i - centerIdx); 

                     const spread = state.qty > 5 ? 50 : 60; 
                     
                     x = dir * spread;
                     y = dist * -20; 
                     
                     const baseScale = 1.0 - (dist * 0.1); 
                     z = 10 - Math.floor(dist);

                     s = baseScale;
                     o = 1;
                } else {
                     x = 0; y = 50; s = 0.5; o = 0;
                }

                s = s * size.scaleFactor;
                const finalX = x + flav.xFix;
                const finalY = y + flav.yFix;

                cup.style.transform = `translate(${finalX}px, ${finalY}px) scale(${s})`;
                cup.style.opacity = o;
                cup.style.zIndex = z;
            });

            document.getElementById('sizePill').style.transform = `translateX(${state.sizeIdx * 100}%)`;
            document.getElementById('flavorPill').style.transform = `translateX(${state.flavorIdx * 100}%)`;
            
            updateOptions(0, state.sizeIdx);
            updateOptions(1, state.flavorIdx);
        }

        function updateOptions(groupIdx, activeIdx) {
            const group = document.querySelectorAll('.segment-control')[groupIdx];
            group.querySelectorAll('.segment-opt').forEach((opt, i) => {
                if (i === activeIdx) opt.classList.add('active');
                else opt.classList.remove('active');
            });
        }

        // --- ROBUST NUMBER ANIMATION ---
        function updateQty(n) {
            const newVal = state.qty + n;
            if(newVal >= 1 && newVal <= 20) {
                const dir = n > 0 ? 'up' : 'down';
                animateQtyChange(state.qty, newVal, dir);
                state.qty = newVal; 
                render(); 
            }
        }

        function animateQtyChange(oldVal, newVal, direction) {
            const container = document.getElementById('qtyDisplay');
            // Grab all current numbers to wipe them away
            const existingSpans = Array.from(container.querySelectorAll('.qty-num'));

            // Create new
            const newSpan = document.createElement('span');
            newSpan.className = 'qty-num';
            newSpan.innerText = newVal;
            
            // Start Position
            if (direction === 'up') {
                newSpan.style.transform = 'translateY(100%)';
            } else {
                newSpan.style.transform = 'translateY(-100%)';
            }
            newSpan.style.opacity = '0';
            
            container.appendChild(newSpan);

            requestAnimationFrame(() => {
                // Animate New In
                newSpan.style.transform = 'translateY(0)';
                newSpan.style.opacity = '1';

                // Animate All Old Out
                existingSpans.forEach(span => {
                    if (direction === 'up') {
                        span.style.transform = 'translateY(-100%)';
                    } else {
                        span.style.transform = 'translateY(100%)';
                    }
                    span.style.opacity = '0';
                });
            });

            // Clean up old
            setTimeout(() => {
                existingSpans.forEach(span => {
                    if (span.parentNode) span.parentNode.removeChild(span);
                });
            }, 400);
        }

        function setSize(i) { state.sizeIdx = i; render(); }
        function setFlavor(i) { state.flavorIdx = i; render(); }

        // --- CART LOGIC ---
        function addToCart() {
            saleSound.currentTime = 0; 
            saleSound.play().catch(e => {});

            const flav = flavors[state.flavorIdx];
            const size = sizes[state.sizeIdx];
            
            const rect = cupContainer.getBoundingClientRect();
            const flyCup = document.createElement('img');
            flyCup.src = flav.img;
            flyCup.className = 'flying-cup';
            
            flyCup.style.left = (rect.left + rect.width/2 - 50) + 'px'; 
            flyCup.style.top = (rect.top + 50) + 'px';
            document.body.appendChild(flyCup);

            requestAnimationFrame(() => {
                const targetY = window.innerHeight - 80;
                const targetX = window.innerWidth / 2 - 50;
                flyCup.style.transform = `translate(${targetX - parseFloat(flyCup.style.left) + 50}px, ${targetY - parseFloat(flyCup.style.top)}px) scale(0.1)`;
                flyCup.style.opacity = 0;
            });

            setTimeout(() => {
                document.body.removeChild(flyCup);
                cart.push({
                    flavor: flav.name,
                    size: state.sizeIdx,
                    qty: state.qty,
                    price: (30 + size.priceMod) * state.qty
                });
                updateCartUI();
                
                // Reset Quantity to 1
                animateQtyChange(state.qty, 1, 'down');
                state.qty = 1;
                render();
            }, 550);
        }

        function updateCartUI() {
            const totalItems = cart.reduce((acc, item) => acc + item.qty, 0);
            if (totalItems > 0) {
                const totalPrice = cart.reduce((acc, item) => acc + item.price, 0);
                document.getElementById('cartTotal').innerText = `${totalItems} items ‚Ä¢ ¬•${totalPrice}`;
                document.getElementById('cartBar').classList.add('show');
                const badge = document.getElementById('cartBadge');
                badge.innerText = totalItems;
                badge.classList.add('show');
                phoneApp.classList.add('cart-active');
            } else {
                document.getElementById('cartBar').classList.remove('show');
                document.getElementById('cartBadge').classList.remove('show');
                phoneApp.classList.remove('cart-active');
            }
        }

        document.querySelector('.anim-text').innerText = flavors[0].name;

    </script>
</body>
</html>
